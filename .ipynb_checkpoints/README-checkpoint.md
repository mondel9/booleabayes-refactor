# Network Tools

Suite of tools for building, fitting rules, and simulating networks.

## Boolean Networks

### Structure

In `python_tools`, the file `make_tf_network` will generate the structure of the network (TF nodes and associated 
edges). `make_regulons` in the parent folder will generate networks connecting each TF in the main GRN to associated 
regulated genes. This can be used for imputing expression of TFs from single cell data, which has high rates of 
dropouts, especially for TFs. The `make_tf_network` script needs to be run **first** before trying to run `main.py` 
because it generates the network structure (connections and nodes list).  

### Rule Fitting

 The files `graph_sim.py`, `graph_fit.py`, and `graph_utils.py` are directly from David's code. I have updated `main
 .py` to fit and simulate a Boolean network using our BooleaBayes tool with single cell data in `graph_fit_edits.py`. 

`get_attractors.py` is also directly from David, and is used to generate attractors from the network simulations. 
These attractors are then plugged into `main.py` using their IDs in order to run simulations with an attractor as a
starting point, and the _in silico_ perturbations. 

`rules.txt` is the output of the graph fitting.

`plot_rule_confidence.py` is a script to sample randomly from the state transition graph and evaluate the 
dependence of the rule confidence 
(from 0.0 to 0.5, or |rule - 0.5|) on a state's distance from any attractors (where samples are highly concentrated).
 With 50 bulk RNA-seq samples, BooleaBayes has relatively consistent confidence at any distance from attractors due 
 to the sparsity of the network, with only a slight increase in the mean confidence of rules for each state with 
 shorter distances. This can be used to compare uncertainty in models based on the input data; i.e. single cell data 
 should show less uncertainty than bulk data because of the increased coverage of the state space.

### Stability Analysis

`stability.py` is based on the idea used for measuring the effect of perturbations to network dynamics, namely, how 
many steps it takes to get past a certain radius with a random walk from the attractor. At the beginning of this 
script, the user must input the indices of known steady states and the actual attractors found in the network using 
`get_attractors.py`. For different radii (default from 1 to 8), the code calls a random walk that was run in `main.py` 
previously and saved in a csv as `walks/[random_seed]/len_walks_[radius].csv`. The code will produce a plot of the 
distribution of steps for each radius, a boxplot showing the same thing, and a lineplot of the Earth-movers distance 
between consecutive distributions. Lastly, the code will generate a plot of the median number of steps to leave each 
basin by size, including 1000 random walks from each of 100 random starting states, as a control, and 1000 random 
walks from each attractor (previously determined). 

### Fit Validation and Accuracy on External Datasets
`fit_validation.py` is used to test the accuracy of the fitted rules on different datasets, including the dataset on 
which the rules were trained (internal error).  `plot_accuracy` within this file will plot actual normalized 
expression versus predicted expression based on rule for each sample in a dataset. This function also saves a csv 
called `validation.csv` with the actual and predicted values. The file will also plot a receiver
 operating characteristic curve (ROC) for each transcription factor in the network to show the false positive rate 
 versus the true positive rate for each TF rule, based on the `validation.py` file saved previously. This script can 
 be used to compare the accuracy of prediction for different network structures, different training sets of data, 
 etc. for model selection.  

## Bayesian Networks

`dbn_fit.py`, `dbn_sim.py`, `dbn_utils.py`, and `dbn_main.py` are used to fit and simulate a Bayesian Network. 
They run on a test network in which we know the rules, network structure, and time courses for model selection and 
validation. 

## Paths between Attractors
The script `visualize_paths.py` takes in a network structure, rules, data, and random walks generated by `main.py
` and outputs plots of the random walks with attractors from `get_attractors.py`. It first reduces the n-dimensional
 space to a 2 dimensional PCA, where n is the number of nodes in the network. There are options to fit the PCA on
  only the attractors (not recommended), or on the entire random walk dataset. Any random walks previousy generated
   can be used, but this is most helpful in visualizing transitions from one attractor basin to another. 